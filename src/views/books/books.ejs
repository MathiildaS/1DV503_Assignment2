<h1>Welcome to the magical Book Store!</h1>

<h3>Search for books</h3>

<section class="form-container">
  <form action="/books" method="GET">
    <label for="subject">Subject</label>
    <select id="subject" name="subject">
      <option value="">-- All subjects --</option>
      <% subjects.forEach(subject=> { %>
        <option value="<%= subject %>" <% if (selectedSubject===subject) { %>
          selected
          <% } %>>
            <%= subject %>
        </option>
      <% }) %>
    </select>

    <label for="author">Author</label>
    <input id="author" type="text" name="author" value="<%= author %>" />

    <label for="title">Title</label>
    <input id="title" type="text" name="title" value="<%= title %>" />

    <button type="submit" class="btn">Search</button>
  </form>
</section>

<section class="books-page">
  <% if (books && books.length> 0) { %>
    <h3>Found books</h3>

    <% books.forEach(book=> { %>
      <div class="bookInfo">
        <h4><%= book.title %></h4>
        <div><b>Author:</b> <%= book.author %></div>
        <div><b>ISBN:</b> <%= book.isbn %></div>
        <div><b>Price:</b> $<%= Number(book.price).toFixed(2) %></div>
        <div><b>Subject:</b> <%= book.subject %></div>

        <% if (isLoggedInUser) { %>
          <form action="/cart/add" method="POST" class="add-to-cart">
            <input type="hidden" name="isbn" value="<%= book.isbn %>">
            <input type="number" name="qty" min="1" value="1" class="qty-input">
            <button type="submit" class="btn cart-btn">Add to cart</button>
          </form>
        <% } %>
      </div>
    <% }) %>

    <% if (totalPages > 1) { %>
      <div class="pagination">
        <% const subjectParam = encodeURIComponent(selectedSubject || '') %>
        <% const authorParam = encodeURIComponent(author || '') %>
        <% const titleParam = encodeURIComponent(title || '') %>

        <% if (currentPage > 1) { %>
          <a class="btn pag-btn"
             href="/books?subject=<%= subjectParam %>&author=<%= authorParam %>&title=<%= titleParam %>&page=<%= currentPage - 1 %>">
            Previous
          </a>
        <% } %>
        <span>Page <%= currentPage %> of <%= totalPages %></span>

        <% if (currentPage < totalPages) { %>
          <a class="btn pag-btn"
            href="/books?subject=<%= subjectParam %>&author=<%= authorParam %>&title=<%= titleParam %>&page=<%= currentPage + 1 %>">
            Next
          </a>
        <% } %>
      </div>
    <% } %> 
    <% } else { %>
      <h3>No books found.</h3>
    <% } %>
</section>